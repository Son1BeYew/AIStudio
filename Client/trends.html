<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xu H∆∞·ªõng | EternaPicSHT AI</title>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <link rel="stylesheet" href="/assets/css/header.css" />
  <link rel="stylesheet" href="/assets/css/footer.css" />
  <link rel="stylesheet" href="/assets/css/trends.css" />
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div id="header"></div>

  <div class="trends-container">
    <section class="trends-hero">
      <h1>XU H∆Ø·ªöNG C√îNG NGH·ªÜ AI</h1>
      <p>Kh√°m ph√° nh·ªØng phong c√°ch t·∫°o ·∫£nh m·ªõi nh·∫•t tr√™n EternaPicSHT</p>
    </section>

    <section class="popular-trends">
      <div class="section-header">
        <h2>Xu h∆∞·ªõng ph·ªï bi·∫øn hi·ªán nay</h2>
        <p>Nh·ªØng phong c√°ch ·∫£nh n·ªïi b·∫≠t</p>
      </div>
      <div class="trends-grid">
        <!-- Skeleton cards hi·ªÉn th·ªã ngay, s·∫Ω ƒë∆∞·ª£c thay th·∫ø b·∫±ng data th·∫≠t -->
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
        <div class="trend-card skeleton-card">
          <div class="trend-image skeleton-image"></div>
          <h3 class="skeleton-text"></h3>
          <p class="skeleton-text"></p>
        </div>
      </div>
    </section>

    <section class="trends-cta">
      <h2>B·∫°n ƒë√£ s·∫µn s√†ng t·∫°o ·∫£nh theo xu h∆∞·ªõng?</h2>
      <p>Th·ª≠ c√°c phong c√°ch m·ªõi nh·∫•t c·ªßa ch√∫ng t√¥i</p>
      <button class="btn-primary" onclick="window.location.href='/tao-anh.html'">
        B·∫Øt ƒë·∫ßu t·∫°o ·∫£nh
      </button>
    </section>
  </div>

  <div id="footer"></div>

  <script src="/assets/js/auth-utils.js"></script>
  <script src="/assets/js/main.js"></script>
  <script src="/assets/js/floating-chat-loader.js"></script>
</body>

</html>
<script>
  // API calls ƒë·ªÉ l·∫•y d·ªØ li·ªáu th·∫≠t
  const API_BASE = "/api/trends";

  // Cache ƒë·ªÉ l∆∞u data trends
  let cachedTrends = null;

  // Preload images ƒë·ªÉ load nhanh h∆°n
  function preloadImages(urls) {
    urls.forEach(url => {
      if (url) {
        const img = new Image();
        img.src = url;
      }
    });
  }

  // ƒê·ªãnh d·∫°ng th·ªùi gian
  function formatTimeAgo(date) {
    const now = new Date();
    const diffMs = now - new Date(date);
    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
    const diffDays = Math.floor(diffHours / 24);

    if (diffDays === 0) {
      if (diffHours === 0) return "V·ª´a xong";
      return `${diffHours} gi·ªù tr∆∞·ªõc`;
    } else if (diffDays === 1) {
      return "H√¥m qua";
    } else if (diffDays <= 7) {
      return `${diffDays} ng√†y tr∆∞·ªõc`;
    } else {
      return new Date(date).toLocaleDateString("vi-VN");
    }
  }

  // T·∫£i d·ªØ li·ªáu xu h∆∞·ªõng ph·ªï bi·∫øn
  async function loadPopularTrends() {
    console.log("üîÑ Loading popular trends...");
    try {
      // Check sessionStorage cache first
      const cached = sessionStorage.getItem('trendsCache');
      const cacheTime = sessionStorage.getItem('trendsCacheTime');
      const now = Date.now();

      // Use cache if less than 5 minutes old
      if (cached && cacheTime && (now - parseInt(cacheTime)) < 300000) {
        console.log("üì¶ Using cached trends data");
        const trends = JSON.parse(cached);
        renderTrends(trends);
        return;
      }

      const response = await fetch(`${API_BASE}/popular`);
      console.log("üì° API Response status:", response.status);

      if (!response.ok) throw new Error("Failed to load trends");

      const trends = await response.json();
      console.log("üìä Popular trends data:", trends);

      // Cache the data
      sessionStorage.setItem('trendsCache', JSON.stringify(trends));
      sessionStorage.setItem('trendsCacheTime', now.toString());

      // Preload images immediately
      preloadImages(trends.map(t => t.image).filter(Boolean));

      renderTrends(trends);
    } catch (error) {
      console.error("Error loading popular trends:", error);
      // Gi·ªØ mock data n·∫øu API th·∫•t b·∫°i
    }
  }

  // Render trends to DOM
  function renderTrends(trends) {
    const trendsGrid = document.querySelector(".trends-grid");
    if (!trendsGrid) return;

    // Build HTML string first (faster than multiple appendChild)
    const html = trends.map(trend => `
      <div class="trend-card">
        <div class="trend-image" style="${trend.image
          ? `background-image: url('${trend.image}')`
          : `background: linear-gradient(135deg, #${Math.floor(
            Math.random() * 16777215
          ).toString(16)}, #${Math.floor(
            Math.random() * 16777215
          ).toString(16)})`
        }"></div>
        <h3>${trend.title}</h3>
        <p>${trend.description || "Style ·∫£nh ƒë·ªôc ƒë√°o v√† s√°ng t·∫°o"}</p>
      </div>
    `).join('');

    trendsGrid.innerHTML = html;
  }

  // Th√™m loading states
  function showLoading() {
    const loadingElements = document.querySelectorAll(
      ".trends-grid, .highlights-grid, .stats-grid"
    );
    loadingElements.forEach((el) => {
      el.style.opacity = "1";
      el.style.pointerEvents = "none";
    });
  }

  function hideLoading() {
    const loadingElements = document.querySelectorAll(
      ".trends-grid, .highlights-grid, .stats-grid"
    );
    loadingElements.forEach((el) => {
      el.style.opacity = "1";
      el.style.pointerEvents = "auto";
    });
  }

  // Start loading immediately (don't wait for DOMContentLoaded)
  const trendsPromise = fetch(`${API_BASE}/popular`).then(r => r.json()).catch(() => null);

  // Kh·ªüi t·∫°o khi DOM load xong
  document.addEventListener("DOMContentLoaded", async function () {
    showLoading();

    // Use pre-fetched data if available
    const prefetchedTrends = await trendsPromise;
    if (prefetchedTrends) {
      preloadImages(prefetchedTrends.map(t => t.image).filter(Boolean));
      sessionStorage.setItem('trendsCache', JSON.stringify(prefetchedTrends));
      sessionStorage.setItem('trendsCacheTime', Date.now().toString());
      renderTrends(prefetchedTrends);
    }

    // Load stats separately
    if (typeof loadTrendsStats === 'function') {
      await loadTrendsStats();
    }

    hideLoading();
    if (typeof refreshBtn !== 'undefined') {
      document.body.appendChild(refreshBtn);
    }
  });
</script>
</body>

</html> 