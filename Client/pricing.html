<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£ng gi√° | EternaPicSHT AI</title>
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link rel="stylesheet" href="/assets/css/pricing.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <div id="header"></div>

    <div class="pricing-container">
      <!-- Hero Section -->
      <section class="pricing-hero">
        <h1>B·∫£ng Gi√° D·ªãch V·ª•</h1>
        <p>Ch·ªçn g√≥i c∆∞·ªõc ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n</p>
      </section>

      <!-- Pricing Trends Chart -->
      <section class="pricing-trends">
        <div class="trends-header">
          <h2>Xu H∆∞·ªõng Gi√° Th√°ng N√†y</h2>
          <p>Bi·ªÉu ƒë·ªì thay ƒë·ªïi gi√° t·∫°o ·∫£nh trong 30 ng√†y qua</p>
        </div>
        <div class="chart-container">
          <canvas id="pricingChart"></canvas>
        </div>
        <div class="trends-stats">
          <div class="stat-card">
            <h3>Gi√° B√¨nh Qu√¢n</h3>
            <p class="stat-value">‚Ç´2,500</p>
          </div>
          <div class="stat-card">
            <h3>Gi√° Th·∫•p Nh·∫•t</h3>
            <p class="stat-value">‚Ç´2,000</p>
          </div>
          <div class="stat-card">
            <h3>Gi√° Cao Nh·∫•t</h3>
            <p class="stat-value">‚Ç´3,000</p>
          </div>
          <div class="stat-card">
            <h3>T·ªïng ·∫¢nh T·∫°o</h3>
            <p class="stat-value">125,450</p>
          </div>
        </div>
      </section>

      <!-- Pricing Table -->
      <section class="pricing-table-section">
        <h2>üí≥ B·∫£ng Gi√° T·∫°o ·∫¢nh</h2>
        <div class="pricing-table-wrapper">
          <table class="pricing-table">
            <thead>
              <tr>
                <th>Ch·∫ø ƒê·ªô T·∫°o</th>
                <th>Chi Ph√≠ / L·∫ßn</th>
                <th>Gi·ªõi H·∫°n / Ng√†y</th>
                <th>Ch·∫•t L∆∞·ª£ng</th>
                <th>T·ªëc ƒê·ªô</th>
                <th>H·ªó Tr·ª£</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>C√° Nh√¢n</strong></td>
                <td class="price">‚Ç´2,500</td>
                <td>Kh√¥ng gi·ªõi h·∫°n</td>
                <td><span class="quality-badge standard">Chu·∫©n</span></td>
                <td>‚ö° 30 gi√¢y</td>
                <td>üìß Email</td>
              </tr>
              <tr>
                <td><strong>B·ªëi C·∫£nh</strong></td>
                <td class="price">‚Ç´3,000</td>
                <td>Kh√¥ng gi·ªõi h·∫°n</td>
                <td><span class="quality-badge standard">Chu·∫©n</span></td>
                <td>‚ö° 45 gi√¢y</td>
                <td>üìß Email</td>
              </tr>
              <tr>
                <td><strong>Trang Ph·ª•c/T√≥c</strong></td>
                <td class="price">‚Ç´2,500</td>
                <td>Kh√¥ng gi·ªõi h·∫°n</td>
                <td><span class="quality-badge standard">Chu·∫©n</span></td>
                <td>‚ö° 30 gi√¢y</td>
                <td>üìß Email</td>
              </tr>
              <tr>
                <td><strong>Hot Trend</strong></td>
                <td class="price">‚Ç´5,000</td>
                <td>5 ·∫£nh/ng√†y</td>
                <td><span class="quality-badge premium">Premium</span></td>
                <td>‚ö° 20 gi√¢y</td>
                <td>üì± Chat 24/7</td>
              </tr>
              <tr>
                <td><strong>Batch Processing</strong></td>
                <td class="price">‚Ç´20,000</td>
                <td>50 ·∫£nh/ng√†y</td>
                <td><span class="quality-badge premium">Premium</span></td>
                <td>‚ö° 15 gi√¢y/·∫£nh</td>
                <td>üì± Chat + Phone</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Premium Subscription Plans -->
      <section class="subscription-plans">
        <h2>üì¶ G√≥i Premium Tr·∫£ Ph√≠</h2>
        <div class="subscription-grid">
          <div class="subscription-card subscription-card--starter">
            <div class="plan-header">
              <h3>üéØ Mi·ªÖn Ph√≠</h3>
              <p class="plan-price">‚Ç´0</p>
              <p class="plan-credit">15 ·∫£nh/ng√†y</p>
            </div>
            <ul class="plan-features">
              <li>‚úì 15 ·∫£nh t·∫°o mi·ªÖn ph√≠ m·ªói ng√†y</li>
              <li>‚úì Ch·∫•t l∆∞·ª£ng chu·∫©n</li>
              <li>‚úì T·ªëc ƒë·ªô b√¨nh th∆∞·ªùng</li>
              <li>‚úì C√≥ watermark</li>
            </ul>
            <button
              class="subscription-btn"
              onclick="window.location.href='/tao-anh.html'"
            >
              S·ª≠ D·ª•ng Ngay
            </button>
          </div>

          <div class="subscription-card subscription-card--professional">
            <div class="plan-header">
              <h3>‚≠ê G√≥i Pro</h3>
              <p class="plan-price">‚Ç´199,000</p>
              <p class="plan-credit">1 th√°ng</p>
            </div>
            <div class="plan-badge">Ph·ªï Bi·∫øn</div>
            <ul class="plan-features">
              <li>‚úì T·∫°o ·∫£nh kh√¥ng gi·ªõi h·∫°n</li>
              <li>‚úì Ch·∫•t l∆∞·ª£ng cao (4K)</li>
              <li>‚úì T·ªëc ƒë·ªô ∆∞u ti√™n</li>
              <li>‚úì Batch processing (10 ·∫£nh)</li>
              <li>‚úì H·ªó tr·ª£ chat 24/7</li>
              <li>‚úì Kh√¥ng watermark</li>
            </ul>
            <button
              class="subscription-btn subscription-btn--professional"
              onclick="window.location.href='/topup.html'"
            >
              N√¢ng C·∫•p Ngay
            </button>
          </div>

          <div class="subscription-card subscription-card--enterprise">
            <div class="plan-header">
              <h3>üëë G√≥i Max</h3>
              <p class="plan-price">‚Ç´1,990,000</p>
              <p class="plan-credit">1 nƒÉm (ti·∫øt ki·ªám 17%)</p>
            </div>
            <div class="plan-badge">Gi√° T·ªët Nh·∫•t</div>
            <ul class="plan-features">
              <li>‚úì T·∫•t c·∫£ t√≠nh nƒÉng G√≥i Pro</li>
              <li>‚úì Ch·∫•t l∆∞·ª£ng si√™u cao (8K)</li>
              <li>‚úì T·ªëc ƒë·ªô t·ªëi ƒëa</li>
              <li>‚úì Batch processing kh√¥ng gi·ªõi h·∫°n</li>
              <li>‚úì H·ªó tr·ª£ ∆∞u ti√™n 24/7</li>
              <li>‚úì API Access</li>
              <li>‚úì Qu·∫£n l√Ω team (5 th√†nh vi√™n)</li>
            </ul>
            <button
              class="subscription-btn subscription-btn--enterprise"
              onclick="window.location.href='/topup.html'"
            >
              N√¢ng C·∫•p Ngay
            </button>
          </div>
        </div>
      </section>

  
      <!-- FAQ Section -->
      <section class="pricing-faq">
        <h2>‚ùì C√¢u H·ªèi Th∆∞·ªùng G·∫∑p</h2>
        <div class="faq-grid">
          <div class="faq-item">
            <h3>Gi√° t·∫°o ·∫£nh ƒë∆∞·ª£c t√≠nh nh∆∞ th·∫ø n√†o?</h3>
            <p>
              M·ªói l·∫ßn t·∫°o ·∫£nh t√≠nh t·ª´ 2,500‚Ç´ - 5,000‚Ç´ t√πy v√†o lo·∫°i ch·∫ø ƒë·ªô. Hot
              Trend t√≠nh cao h∆°n v√¨ ch·∫•t l∆∞·ª£ng cao h∆°n.
            </p>
          </div>
          <div class="faq-item">
            <h3>C√≥ th·ªÉ ho√†n ti·ªÅn kh√¥ng?</h3>
            <p>
              Ch√∫ng t√¥i h·ªó tr·ª£ ho√†n ti·ªÅn trong 7 ng√†y n·∫øu b·∫°n ch∆∞a s·ª≠ d·ª•ng
              credits. Li√™n h·ªá h·ªó tr·ª£ ƒë·ªÉ x·ª≠ l√Ω.
            </p>
          </div>
          <div class="faq-item">
            <h3>Credits h·∫øt h·∫°n khi n√†o?</h3>
            <p>
              Credits kh√¥ng bao gi·ªù h·∫øt h·∫°n. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng b·∫•t c·ª© l√∫c n√†o
              kh√¥ng c√≥ th·ªùi gian gi·ªõi h·∫°n.
            </p>
          </div>
          <div class="faq-item">
            <h3>C√≥ gi·∫£m gi√° cho kh√°ch h√†ng th∆∞·ªùng xuy√™n?</h3>
            <p>
              C√≥! Kh√°ch h√†ng n·∫°p tr√™n 500,000‚Ç´/th√°ng ƒë∆∞·ª£c gi·∫£m 10%. Li√™n h·ªá ƒë·ªÉ
              ƒë∆∞·ª£c h·ªó tr·ª£ ƒë·∫∑c bi·ªát.
            </p>
          </div>
          <div class="faq-item">
            <h3>T√¥i c√≥ th·ªÉ t·∫°o ·∫£nh bao nhi√™u l·∫ßn m·ªói ng√†y?</h3>
            <p>
              Kh√¥ng c√≥ gi·ªõi h·∫°n s·ªë l·∫ßn/ng√†y. Ch·ªâ c·∫ßn c√≥ credits, b·∫°n c√≥ th·ªÉ t·∫°o
              li√™n t·ª•c.
            </p>
          </div>
          <div class="faq-item">
            <h3>Ch·∫•t l∆∞·ª£ng ·∫£nh kh√°c nhau nh∆∞ th·∫ø n√†o?</h3>
            <p>
              Ch·∫ø ƒë·ªô Premium (Hot Trend) d√πng m√¥ h√¨nh AI cao c·∫•p h∆°n, cho ·∫£nh
              chi ti·∫øt v√† s·∫Øc n√©t h∆°n.
            </p>
          </div>
        </div>
      </section>

      <!-- CTA Section -->
      <section class="pricing-cta">
        <h2>S·∫µn S√†ng B·∫Øt ƒê·∫ßu?</h2>
        <p>N·∫°p ti·ªÅn ngay ƒë·ªÉ t·∫°o ·∫£nh ƒë·∫πp nh·∫•t c·ªßa b·∫°n</p>
        <div class="cta-buttons">
          <button
            class="btn-primary"
            onclick="window.location.href='/topup.html'"
          >
            üí∞ N·∫°p Ti·ªÅn Ngay
          </button>
          <button
            class="btn-secondary"
            onclick="window.location.href='/tao-anh.html'"
          >
            üé® Th·ª≠ Mi·ªÖn Ph√≠
          </button>
        </div>
      </section>
    </div>

    <div id="footer"></div>

    <script src="/assets/js/auth-utils.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/floating-chat-loader.js"></script>
    <script>
      // Check user's current plan and update UI accordingly
      async function checkUserPlanAndUpdateUI() {
        const token = localStorage.getItem("token");
        if (!token) {
          console.log("User not logged in - showing default pricing buttons");
          return;
        }

        try {
          const response = await fetch("/api/topup/account-summary", {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (!response.ok) {
            console.log("Failed to fetch user plan - showing default buttons");
            return;
          }

          const data = await response.json();
          const currentPlan = data.currentPlan || "FREE";

          console.log("User current plan:", currentPlan);
          updatePricingButtons(currentPlan);

        } catch (error) {
          console.error("Error checking user plan:", error);
        }
      }

      // Update pricing buttons based on user's current plan
      function updatePricingButtons(currentPlan) {
        // Map plan names to card classes
        const planToCardMap = {
          'FREE': 'subscription-card--starter',
          'BASIC+': 'subscription-card--starter', // No BASIC+ card exists, map to starter
          'PRO': 'subscription-card--professional',
          'MAX': 'subscription-card--enterprise'
        };

        // Get all subscription cards
        const cards = document.querySelectorAll('.subscription-card');

        cards.forEach(card => {
          const button = card.querySelector('.subscription-btn');
          const cardClass = Array.from(card.classList).find(cls => cls.startsWith('subscription-card--'));

          // Check if this card matches user's current plan
          const isActivePlan = Object.values(planToCardMap).includes(cardClass) &&
                             Object.keys(planToCardMap).find(plan => planToCardMap[plan] === cardClass) === currentPlan;

          if (isActivePlan) {
            // Update button for current plan
            button.textContent = 'ƒêang S·ª≠ D·ª•ng';
            button.classList.add('subscription-btn--active');
            button.disabled = true;
            button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            button.style.cursor = 'not-allowed';
            button.style.boxShadow = '0 4px 15px rgba(16, 185, 129, 0.3)';

            // Add "Current Plan" badge
            if (!card.querySelector('.current-plan-badge')) {
              const badge = document.createElement('div');
              badge.className = 'current-plan-badge';
              badge.textContent = 'üéâ ƒêang D√πng';
              badge.style.cssText = `
                position: absolute;
                top: -10px;
                right: -10px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 5px 15px;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                box-shadow: 0 2px 10px rgba(16, 185, 129, 0.4);
                z-index: 10;
              `;
              card.style.position = 'relative';
              card.appendChild(badge);
            }
          } else {
            // Ensure other buttons are enabled and have correct text
            const cardTitle = card.querySelector('h3')?.textContent;

            if (cardTitle?.includes('Mi·ªÖn Ph√≠')) {
              button.textContent = 'S·ª≠ D·ª•ng Ngay';
            } else {
              button.textContent = 'N√¢ng C·∫•p Ngay';
            }

            button.disabled = false;
            button.classList.remove('subscription-btn--active');
            button.style.background = '';
            button.style.cursor = '';
            button.style.boxShadow = '';

            // Remove current plan badge if exists
            const existingBadge = card.querySelector('.current-plan-badge');
            if (existingBadge) {
              existingBadge.remove();
            }
          }
        });
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        // Check user plan and update UI
        checkUserPlanAndUpdateUI();
      });
      // Initialize chart
      const ctx = document.getElementById("pricingChart").getContext("2d");

      // Sample data for the last 30 days
      const days = Array.from({ length: 30 }, (_, i) => `Ng√†y ${i + 1}`);
      const prices = [
        2500, 2500, 2600, 2500, 2400, 2500, 2500, 2550, 2500, 2480, 2500, 2520,
        2500, 2500, 2600, 2500, 2450, 2500, 2500, 2500, 2550, 2500, 2500, 2470,
        2500, 2500, 2600, 2500, 2500, 2500,
      ];

      new Chart(ctx, {
        type: "line",
        data: {
          labels: days,
          datasets: [
            {
              label: "Gi√° T·∫°o ·∫¢nh (VND)",
              data: prices,
              borderColor: "#4CAF50",
              backgroundColor: "rgba(76, 175, 80, 0.1)",
              borderWidth: 2,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: "#4CAF50",
              pointBorderColor: "#fff",
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: "top",
              labels: {
                usePointStyle: true,
                padding: 15,
                font: { size: 12, weight: "bold" },
              },
            },
          },
          scales: {
            y: {
              beginAtZero: false,
              min: 2000,
              max: 3500,
              ticks: {
                callback: function (value) {
                  return "‚Ç´" + value.toLocaleString("vi-VN");
                },
              },
            },
            x: {
              display: true,
            },
          },
        },
      });

      // Navigate to topup with amount
      function toTopup(amount) {
        window.location.href = `/topup.html?amount=${amount}`;
      }
    </script>
  </body>
</html>
